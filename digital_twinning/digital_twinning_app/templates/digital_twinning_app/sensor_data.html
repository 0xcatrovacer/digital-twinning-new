{% load static %}
<!DOCTYPE html>
<html>

<head>
    <title>IMU Sensor Data</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
    <style>
        body {
            overflow: hidden;
        }

        .container {
            display: flex;
        }

        .left-side {
            flex: 1;
            padding: 20px;
        }

        .right-side {
            flex: 1;
            padding: 20px;
        }

        #sensor-3d {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.2s ease;
            /* Add transition for smooth rotation */
        }
    </style>
</head>

<body>
    <h1>IMU Sensor Data</h1>
    <div class="container">
        <div class="left-side">
            <h2>Acceleration:</h2>
            <p>x: {{ sensor_data.acceleration_x }}</p>
            <p>y: {{ sensor_data.acceleration_y }}</p>
            <p>z: {{ sensor_data.acceleration_z }}</p>

            <h2>Gyroscope:</h2>
            <p>x: {{ sensor_data.gyroscope_x }}</p>
            <p>y: {{ sensor_data.gyroscope_y }}</p>
            <p>z: {{ sensor_data.gyroscope_z }}</p>
        </div>
        <div class="right-side">
            <h2>3D Model:</h2>
            <div id="sensor-3d" data-gyroscope-x="{{ sensor_data.gyroscope_x }}"
                data-gyroscope-y="{{ sensor_data.gyroscope_y }}" data-gyroscope-z="{{ sensor_data.gyroscope_z }}"></div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js';

        const renderer = new THREE.WebGLRenderer();
        const scene = new THREE.Scene();
        const sensorElement = document.getElementById('sensor-3d');
        const gyroscope_x = parseFloat(sensorElement.getAttribute('data-gyroscope-x'));
        const gyroscope_y = parseFloat(sensorElement.getAttribute('data-gyroscope-y'));
        const gyroscope_z = parseFloat(sensorElement.getAttribute('data-gyroscope-z'));
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight);
        let mesh;

        renderer.setSize(window.innerWidth * 0.75, window.innerHeight * 0.75);
        scene.background = new THREE.Color("white");
        scene.add(new THREE.HemisphereLight(0xffffcc, 0x333399, 1.0));
        camera.position.set(0, 0, -10);

        new GLTFLoader().load("{% static 'images/MPU9255.glb' %}", function ({ scene: model }, animations) {
            scene.add(model);

            model.scale.setScalar(0.25);

            camera.lookAt(model.position);

            mesh = model;
        });

        function animate() {
            if (mesh) {
                if (!isNaN(gyroscope_x) && !isNaN(gyroscope_y) && !isNaN(gyroscope_z)) {
                    const rotationY = gyroscope_y;
                    const rotationZ = gyroscope_z;
                    const rotationX = gyroscope_x;

                    mesh.rotation.set(rotationX, rotationY, rotationZ);
                }
            }

            renderer.render(scene, camera);

            requestAnimationFrame(animate);
        };

        animate();

        document.getElementById('sensor-3d').appendChild(renderer.domElement);
    </script>
</body>

</html>